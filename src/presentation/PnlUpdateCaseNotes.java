package presentation;

import domaine.Note;
import java.awt.event.KeyEvent;
import java.util.Date;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.text.BadLocationException;

/**
 *
 * @author Thery Ehrlich
 */
public class PnlUpdateCaseNotes extends javax.swing.JPanel {

    static void setFocusTitle() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    PnlCase parent;

    /**
     * Creates new form PnlNewCaseNotes
     */
    public PnlUpdateCaseNotes(PnlCase parent) {
        initComponents();
        this.parent = parent;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlNewNotes = new javax.swing.JPanel();
        lblTitle = new javax.swing.JLabel();
        cboTitle = new javax.swing.JComboBox<>();
        lblStepsDone = new javax.swing.JLabel();
        scpStepsDone = new javax.swing.JScrollPane();
        tarStepsDone = new javax.swing.JTextArea();
        lblPartsUsed = new javax.swing.JLabel();
        scpPartsUsed = new javax.swing.JScrollPane();
        tarPartsUsed = new javax.swing.JTextArea();
        lblPartsOrdered = new javax.swing.JLabel();
        scpPartsOrdered = new javax.swing.JScrollPane();
        tarPartsOrdered = new javax.swing.JTextArea();
        lblToDo = new javax.swing.JLabel();
        scpToDo = new javax.swing.JScrollPane();
        tarToDo = new javax.swing.JTextArea();
        btnSave = new javax.swing.JButton();
        btnCancel = new javax.swing.JButton();

        setMinimumSize(new java.awt.Dimension(361, 460));
        setPreferredSize(new java.awt.Dimension(361, 460));

        pnlNewNotes.setBackground(new java.awt.Color(204, 204, 204));
        pnlNewNotes.setMinimumSize(new java.awt.Dimension(361, 412));
        pnlNewNotes.setPreferredSize(new java.awt.Dimension(361, 412));

        lblTitle.setDisplayedMnemonic('t');
        lblTitle.setLabelFor(cboTitle);
        lblTitle.setText("Titre");

        cboTitle.setEditable(true);
        cboTitle.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Mise à jour du statut de la réparation", "Nouvelles informations client", "Demande d'exception" }));
        cboTitle.setToolTipText("");
        cboTitle.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                cboTitleKeyPressed(evt);
            }
        });

        lblStepsDone.setDisplayedMnemonic('e');
        lblStepsDone.setLabelFor(tarStepsDone);
        lblStepsDone.setText("Etapes effectuées");
        lblStepsDone.setDisplayedMnemonicIndex(7);

        tarStepsDone.setColumns(20);
        tarStepsDone.setLineWrap(true);
        tarStepsDone.setRows(5);
        tarStepsDone.setWrapStyleWord(true);
        tarStepsDone.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                tarStepsDoneKeyPressed(evt);
            }
        });
        scpStepsDone.setViewportView(tarStepsDone);

        lblPartsUsed.setDisplayedMnemonic('u');
        lblPartsUsed.setLabelFor(tarPartsUsed);
        lblPartsUsed.setText("Pièces utilisées");

        tarPartsUsed.setColumns(20);
        tarPartsUsed.setLineWrap(true);
        tarPartsUsed.setRows(5);
        tarPartsUsed.setWrapStyleWord(true);
        tarPartsUsed.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                tarPartsUsedKeyPressed(evt);
            }
        });
        scpPartsUsed.setViewportView(tarPartsUsed);

        lblPartsOrdered.setDisplayedMnemonic('c');
        lblPartsOrdered.setLabelFor(tarPartsOrdered);
        lblPartsOrdered.setText("Pièces commandées");
        lblPartsOrdered.setDisplayedMnemonicIndex(7);

        tarPartsOrdered.setColumns(20);
        tarPartsOrdered.setLineWrap(true);
        tarPartsOrdered.setRows(5);
        tarPartsOrdered.setWrapStyleWord(true);
        tarPartsOrdered.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                tarPartsOrderedKeyPressed(evt);
            }
        });
        scpPartsOrdered.setViewportView(tarPartsOrdered);

        lblToDo.setDisplayedMnemonic('f');
        lblToDo.setLabelFor(tarToDo);
        lblToDo.setText("A effectuer");

        tarToDo.setColumns(20);
        tarToDo.setLineWrap(true);
        tarToDo.setRows(5);
        tarToDo.setWrapStyleWord(true);
        tarToDo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                tarToDoKeyPressed(evt);
            }
        });
        scpToDo.setViewportView(tarToDo);

        btnSave.setMnemonic('n');
        btnSave.setText("Enregistrer");
        btnSave.setNextFocusableComponent(btnCancel);
        btnSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSaveActionPerformed(evt);
            }
        });

        btnCancel.setText("Annuler");
        btnCancel.setNextFocusableComponent(cboTitle);
        btnCancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCancelActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnlNewNotesLayout = new javax.swing.GroupLayout(pnlNewNotes);
        pnlNewNotes.setLayout(pnlNewNotesLayout);
        pnlNewNotesLayout.setHorizontalGroup(
            pnlNewNotesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlNewNotesLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnlNewNotesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(pnlNewNotesLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(btnCancel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnSave))
                    .addComponent(scpToDo, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(scpPartsOrdered, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(cboTitle, javax.swing.GroupLayout.Alignment.LEADING, 0, 322, Short.MAX_VALUE)
                    .addComponent(scpPartsUsed, javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(scpStepsDone, javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, pnlNewNotesLayout.createSequentialGroup()
                        .addGroup(pnlNewNotesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lblTitle, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblPartsOrdered, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblToDo, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblPartsUsed, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblStepsDone, javax.swing.GroupLayout.Alignment.LEADING))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addGap(29, 29, 29))
        );
        pnlNewNotesLayout.setVerticalGroup(
            pnlNewNotesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlNewNotesLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblTitle)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cboTitle, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(11, 11, 11)
                .addComponent(lblStepsDone)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(scpStepsDone, javax.swing.GroupLayout.DEFAULT_SIZE, 60, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lblPartsUsed)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(scpPartsUsed, javax.swing.GroupLayout.DEFAULT_SIZE, 60, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lblPartsOrdered)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(scpPartsOrdered, javax.swing.GroupLayout.DEFAULT_SIZE, 60, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lblToDo)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(scpToDo, javax.swing.GroupLayout.DEFAULT_SIZE, 60, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(pnlNewNotesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnSave)
                    .addComponent(btnCancel))
                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addComponent(pnlNewNotes, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlNewNotes, javax.swing.GroupLayout.DEFAULT_SIZE, 460, Short.MAX_VALUE)
        );
    }// </editor-fold>//GEN-END:initComponents
    
    //Crée une nouvelle note à partir du texte saisi, la formatte et l'affiche
    private void btnSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSaveActionPerformed
        Date date = new Date();
        String stepsDone = tarStepsDone.getText();
        String partsUsed = tarPartsUsed.getText();
        String partsOrdered = tarPartsOrdered.getText();
        String toDo = tarToDo.getText();
        if (tarStepsDone.getText().length() > 0) {
            stepsDone = "Etapes effectuées: " + tarStepsDone.getText() +";";
        }
        if (tarPartsUsed.getText().length() > 0) {
            partsUsed = "Pièces utilisées: " + tarPartsUsed.getText() + ";";
        }
        if (tarPartsOrdered.getText().length() > 0) {
            partsOrdered = "Pièces commandées: " + tarPartsOrdered.getText() + ";";
        }
        if (tarToDo.getText().length() > 0) {
            toDo = "A effectuer: " + tarToDo.getText() + ";";
        }
        String body = stepsDone + partsUsed + partsOrdered + toDo;
        Note n = new Note(date,cboTitle.getSelectedItem().toString(), body, 0);
        try {
            parent.displayPermaNote(n);
        } catch (BadLocationException ex) {
            Logger.getLogger(PnlUpdateCaseNotes.class.getName()).log(Level.SEVERE, null, ex);
        }
        this.setVisible(false);
        parent.setBtnNewAsVisible();
    }//GEN-LAST:event_btnSaveActionPerformed

    private void btnCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCancelActionPerformed
        this.setVisible(false);
        parent.setBtnNewAsVisible();
    }//GEN-LAST:event_btnCancelActionPerformed

    private void tarStepsDoneKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_tarStepsDoneKeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_TAB) {
            tarPartsUsed.requestFocusInWindow();
            evt.consume();
        }
    }//GEN-LAST:event_tarStepsDoneKeyPressed

    private void cboTitleKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_cboTitleKeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_TAB) {
            tarStepsDone.requestFocusInWindow();
            evt.consume();
        }
    }//GEN-LAST:event_cboTitleKeyPressed

    private void tarPartsUsedKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_tarPartsUsedKeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_TAB) {
            tarPartsOrdered.requestFocusInWindow();
            evt.consume();
        }
    }//GEN-LAST:event_tarPartsUsedKeyPressed

    private void tarPartsOrderedKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_tarPartsOrderedKeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_TAB) {
            tarToDo.requestFocusInWindow();
            evt.consume();
        }
    }//GEN-LAST:event_tarPartsOrderedKeyPressed

    private void tarToDoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_tarToDoKeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_TAB) {
            btnSave.requestFocusInWindow();
            evt.consume();
        }
    }//GEN-LAST:event_tarToDoKeyPressed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCancel;
    private javax.swing.JButton btnSave;
    private javax.swing.JComboBox<String> cboTitle;
    private javax.swing.JLabel lblPartsOrdered;
    private javax.swing.JLabel lblPartsUsed;
    private javax.swing.JLabel lblStepsDone;
    private javax.swing.JLabel lblTitle;
    private javax.swing.JLabel lblToDo;
    private javax.swing.JPanel pnlNewNotes;
    private javax.swing.JScrollPane scpPartsOrdered;
    private javax.swing.JScrollPane scpPartsUsed;
    private javax.swing.JScrollPane scpStepsDone;
    private javax.swing.JScrollPane scpToDo;
    private javax.swing.JTextArea tarPartsOrdered;
    private javax.swing.JTextArea tarPartsUsed;
    private javax.swing.JTextArea tarStepsDone;
    private javax.swing.JTextArea tarToDo;
    // End of variables declaration//GEN-END:variables

    protected void setTitleFocused(){
        cboTitle.requestFocusInWindow();
    }
    
}
